<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${student.name}"></title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</head>
<body>
<div th:replace="~{fragments/layout :: app-nav}"></div>
<div class="container mt-4">
    <div th:replace="~{fragments/layout :: subpage-nav}"></div>
    <form th:action="@{/students/{id}(id=${student.id})}" method="post">
        <div class="d-flex justify-content-between align-items-center my-4">
            <h1 class="h3" th:text="${student.name}"></h1>
            <input class="btn btn-primary ms-auto" type="submit" value="Сохранить">
            <div th:replace="~{fragments/modals :: confirm-delete-modal('/students/' + ${student.id}, true, ${student.id})}" sec:authorize="hasAnyRole('ADMIN')"></div>
        </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="id" th:value="${student.id}">
        <div class="form-floating mb-3">
            <input class="form-control" type="text" name="name" id="name" th:value="${student.name}">
            <label for="name">ФИО</label>
        </div>
        <div class="form-floating mb-3">
            <input class="form-control" type="date" name="birthdate" id="birthdate" th:value="${student.birthdate}">
            <label for="name">Дата рождения</label>
        </div>
        <div class="form-floating mb-3">
            <select class="form-select" name="groupId" id="group">
                <option value="">--Выберите группу--</option>
                <optgroup th:each="category : ${categories}" th:label="${category.categoryName}">
                    <option th:each="group : ${category.groups}" th:value="${group.id}"
                            th:text="${group.code}" th:selected="${group.id == student.groupId}"></option>
                </optgroup>
            </select>
            <label for="group">Группа</label>
        </div>
        <div class="mb-3"
             th:classappend="${field.fieldType.name() == 'BOOLEAN'} ? 'form-check' : 'form-floating'"
             th:each="field : ${student.fields}">

            <!-- TEXT -->
            <input class="form-control" type="text" th:if="${field.fieldType.name() == 'TEXT'}"
                   th:name="${'fields[' + field.fieldId + ']'}" th:id="${'fields[' + field.fieldId + ']'}"
                   th:value="${field.value}">
            <!-- NUMBER -->
            <input class="form-control" type="number" th:if="${field.fieldType.name() == 'NUMBER'}"
                   th:name="${'fields[' + field.fieldId + ']'}" th:id="${'fields[' + field.fieldId + ']'}"
                   th:value="${field.value}">
            <!-- BOOLEAN -->
            <input type="checkbox" th:if="${field.fieldType.name() == 'BOOLEAN'}"
                   th:name="${'fields[' + field.fieldId + ']'}" th:id="${'fields[' + field.fieldId + ']'}"
                   th:value="true"
                   th:checked="${field.value == 'true'}">
            <!-- DATE -->
            <input class="form-control" type="date" th:if="${field.fieldType.name() == 'DATE'}"
                   th:name="${'fields[' + field.fieldId + ']'}" th:id="${'fields[' + field.fieldId + ']'}"
                   th:value="${field.value}">
            <!-- ENUM -->
            <select class="form-select" th:if="${field.fieldType.name() == 'ENUM'}"
                    th:name="${'fields[' + field.fieldId + ']'}" th:id="${'fields[' + field.fieldId + ']'}">
                <option value="">--Не выбрано--</option>
                <option th:each="validValue : ${field.validValues}"
                        th:value="${validValue}"
                        th:text="${validValue}"
                        th:selected="${field.value == validValue}">
                </option>
            </select>
            <label th:for="${'fields[' + field.fieldId + ']'}"
                   th:text="${field.fieldName}"
                   th:classappend="${field.fieldType.name() == 'BOOLEAN'} ? 'form-check-label'"></label>
        </div>
    </form>
</div>
</body>
</html>